<div class="jumbotron">
    <h1>{{ title }} <small>By LightSide Labs</small></h1>
</div>

<div type="text/html">
    <h4>If you refresh the page, all entered text will be deleted</h4>
    <ul>
        <li>To use the Create Your CSV page, you need to input text into each of the boxes.
        Your CSV requires a title that will appear in the CSV.  You must also include a grade in the
        "Grade" text box as well as text in the "Text" box.  Otherwise, you will not be able to add the grade
        and text into the file.</li>
        <li>The "Reset" button allows you to completely erase any text you have entered or added.</li>
        <li>The "Add" button allows you to add the document into your CSV file.  When you press the button,
        the "Documents Added:" will count the amount of documents that have been added into the CSV file.</li>
        <li>The "Download CSV" button downloads the CSV file where you can open (via clicking the file) and
        looking the documents inside of the CSV.  And if you wish to add more files, you may do so and
        it will still have your documents that you have initially added.</li>
    </ul>
</div>

<div class="row">

    <div>
        <h3>CSV</h3>
    </div>

    <form role="form">
        <label> Title</label>
        <input class="form-control" id="fileTitle" placeholder="Enter Title of CSV File">
        <br />
        <br />
        <label>Grade</label>
        <input class="grade form-control" id="grade" placeholder="Enter Grade">
        <label>Text</label>
        <textarea class="text form-control" id="text" placeholder="Enter Text" rows="10"></textarea>
        <br>
        <input type="button" class="btn btn-danger" id="reset" value="Reset">
        <input type="button" class="btn btn-default" id="add" value="Add">
        <input type="button" class="btn btn-default" id="submit" value="Download CSV">
    </form>
</div>
    <br>
<div>
    <p style="display:inline;"><strong>Documents Added:</strong></p>
    <p style="display:inline;" id="documentAmount">0</p>
</div>
<div id="pastDocs"></div>


<script type="text/javascript">
    var myCSV = "grade,text\n";
    var documentsAdded = 0;
    function exportToCSV() {
        if (($("#grade").val() != "") || ($("#text").val() != "")) {
            addEssay();
        }
        if(documentsAdded == 0){
            window.alert("Please add some papers");
        }
        else if (confirm("Do you want to download the CSV?"))
        {
            download($("#fileTitle").val()+".csv", myCSV);
        }
    }

    function download(filename, text) {
        var blob = new Blob([myCSV], {type: "text/csv;charset=utf-8"});
        saveAs(blob, $("#fileTitle").val()+".csv");
    }

    function addEssay() {
        if ($("#grade").val() == "") {
            window.alert("Please enter a grade for the paper");
        }
        else if ($("#text").val() == "") {
            window.alert("Please enter the text of the paper");
        }
        else {
            myCSV += $("#grade").val() + ",\"" + $("#text").val().replace(/"/g,"'") + "\"\n";
            documentsAdded++;
            $("#grade").val("");
            $("#text").val("");
            document.getElementById("documentAmount").innerHTML = documentsAdded;
            document.getElementById("pastDocs").innerHTML += "<div class='docBox' id ='docBox' >" + documentsAdded + "</div>";

            $(".docBox").slideDown(130);
            $(".docBox").mouseover(function() {
                $(this).css("background-color","midnightblue");
                $(this).css("color","white");
            });
            $(".docBox").mouseout(function() {
                $(this).css("background-color","lightblue");
                $(this).css("color","black");
            });
            /*This isn't working yet:*/

            /*$(".docBox").click(function() {
                var counter = 0;
                var limit = (parseInt($(this).text()) - 1) * 2 - 1;
                for(var i = 0; i < bingo.length; i++) {
                    if (bingo.charAt(i) == '"') {
                        if (counter < limit) counter++;
                        else {
                            var grade = bingo.substring(i, bingo.indexOf('"',i ));
                            console.log(i + " " + bingo.indexOf('"',i + 1));
                            var text = bingo.substring(i + grade.length, bingo.indexOf('"', i + grade.length + 1));
                            console.log(grade);
                            console.log(text);
                             $("#grade").val(grade);
                             $("#text").val(text);
                             return;
                        }
                    }
             }*/
        }
    }

    function reset() {
        if (confirm("Are you sure you want to reset?")) {
            myCSV = "grade,text\n";
            documentsAdded = 0;
            document.getElementById("documentAmount").innerHTML = documentsAdded;
            $("#grade").val("");
            $("#text").val("");
            $("#fileTitle").val("");
        }
    }

    $(document).ready(function() {
        $("#submit").click(function() {
            exportToCSV();
        });

        $("#add").click(function() {
            addEssay();
        });

        $("#reset").click(function() {
            reset();
        })
    });
</script>
